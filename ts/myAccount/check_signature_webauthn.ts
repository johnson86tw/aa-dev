import { concat, Contract, ethers, Interface } from 'ethers'

if (!process.env.sepolia) {
	throw new Error('Missing .env')
}

const RPC_URL = process.env.sepolia

const sender = '0x67CE34Bc421060B8594CdD361cE201868845045b' // MyAccount
const webauthnValidator = '0xf943a0a7f6a707a18773f2e62f66dbc03c1fcd00'

const provider = new ethers.JsonRpcProvider(RPC_URL)

const messageHash = '0xdbd673cfc5f830d41ef9b1f97563fed4e4851804b66e7f489c288bbc44c8c594'
const encodedSignature =
	'0x00000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000001200000000000000000000000000000000000000000000000000000000000000001d318d7eb74bbebea986c655bd4410170202186b7de6c26c5f0421c7b9028b4632730b5af2fd7172c78a51cf57b6ae75f4f70dbc3c38c2cc96b209cf942adef1e0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002549960de5880e8c687434170f6476605b8fe4aeb9a28632c7995cf3ba831d97631d0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000867b2274797065223a22776562617574686e2e676574222c226368616c6c656e6765223a2232395a7a7a3858344d4e51652d6248356457502d314f534647415332626e39496e43694c76455449785a51222c226f726967696e223a22687474703a2f2f6c6f63616c686f73743a35313733222c2263726f73734f726967696e223a66616c73657d0000000000000000000000000000000000000000000000000000'

// build signature: validator address ++ (bytes, string, uint256, uint256, uint256, bool)
// authenticatorData, clientDataJSON, responseTypeLocation, r, s, usePrecompiled

const IMyAccount = new Interface([
	'function isValidSignature(bytes32 hash, bytes calldata signature) external view returns (bytes4)',
])
const myAccount = new Contract(sender, IMyAccount, provider)

const signature = concat([webauthnValidator, encodedSignature])
const res = await myAccount.isValidSignature(messageHash, signature)

console.log(res === '0x1626ba7e')
